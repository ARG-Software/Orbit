
<div class="drawer">
	<input id="mobile-drawer" type="checkbox" class="drawer-toggle" [checked]="isMobileMenuOpen()" (change)="toggleMobileMenu()" />
	<div class="drawer-content flex flex-col min-h-screen">
		<!-- App Bar -->
		<header class="navbar bg-base-100 shadow-sm z-20 border-b border-base-200 sticky top-0">
			<div class="flex-1 gap-2">
				<label for="mobile-drawer" class="btn btn-ghost btn-circle md:hidden">
          <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
        </label>
         <a routerLink="/dashboard" class="btn btn-ghost normal-case gap-3 px-2 hover:bg-transparent">
            <!-- New Logo -->
            <div class="w-9 h-9 flex items-center justify-center rounded-xl bg-gradient-to-br from-primary to-secondary text-white shadow-lg shadow-primary/30">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path fill-rule="evenodd" d="M9.315 7.584C12.195 3.883 16.695 1.5 21.75 1.5a.75.75 0 01.75.75c0 5.056-2.383 9.555-6.084 12.436h.003c-.004.004-.008.009-.012.013l-2.37 3.046c-.5.643-1.465.714-2.05.149l-1.98-1.915a.75.75 0 010-1.075l2.803-2.71a.75.75 0 011.061 1.06l-2.157 2.086.436.42c.1.098.257.111.372.034l2.7-3.47c.06-.078.11-.16.148-.247.295-.682.626-1.34 1.003-1.959.01-.015.018-.03.029-.045.012-.017.023-.034.036-.05.005-.007.011-.013.016-.02l.008-.01a20.57 20.57 0 002.776-4.62l-3.992 3.992a.75.75 0 11-1.061-1.06l3.42-3.42a20.567 20.567 0 00-4.62 2.777l-.005.005-.009.011-.01.01-.013.016a15.39 15.39 0 00-2.005 1.033.75.75 0 01-.247.148l-3.47 2.7c-.077.115-.064.272.034.373l.42.435-2.086-2.157a.75.75 0 011.06-1.06l2.71 2.802.01.009a.75.75 0 01-1.085.008l-1.915-1.98c-.565-.585-.494-1.55.149-2.05l3.046-2.37.013-.012zM2.25 15.75a.75.75 0 01.75-.75H6.5a.75.75 0 00.75-.75V10.5a.75.75 0 01.75-.75h11.25a.75.75 0 01.75.75v3.75a.75.75 0 00.75.75h3.75a.75.75 0 01.75.75v5.25a.75.75 0 01-.75.75H3a.75.75 0 01-.75-.75V15.75z" clip-rule="evenodd" />
              </svg>
            </div>
          <span class="text-xl font-bold tracking-tight text-base-content hidden sm:block">Freelance<span class="text-primary">OS</span></span>
        </a>
			</div>
			<div class="flex-none hidden md:flex">
        <ul class="menu menu-horizontal p-0 gap-1 font-medium text-sm">
          @for(item of navGroups; track item.label || item.name){
            @if(item.type === 'link') {
               <li><a [routerLink]="item.path" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="rounded-lg" (click)="closeGroup()">{{ item.name }}</a></li>
            }
            @if(item.type === 'group') {
               <li>
                <!-- Desktop Accordion/Dropdown behavior controlled manually -->
                <details [open]="activeGroup() === item.label">
                  <summary class="rounded-lg" (click)="$event.preventDefault(); toggleGroup(item.label)">{{ item.label }}</summary>
                  <ul class="p-2 bg-base-100 rounded-t-none z-30 shadow-lg border border-base-200 min-w-[180px]">
                     @for(child of item.children; track child.path) {
                       <li><a [routerLink]="child.path" routerLinkActive="active" class="rounded-lg" (click)="closeGroup()">{{ child.name }}</a></li>
                     }
                  </ul>
                </details>
               </li>
            }
          }
        </ul>
			</div>
			<div class="flex-none gap-2 ml-2">
        <!-- Theme Controller -->
        <label class="swap swap-rotate btn btn-ghost btn-circle btn-sm text-base-content/70">
          <!-- this hidden checkbox controls the state -->
          <input type="checkbox" class="theme-controller" value="dark" [checked]="isDarkMode()" (change)="toggleTheme()" />
          
          <!-- sun icon -->
          <svg class="swap-on fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,4.93l.71.71A1,1,0,0,0,5.64,7.05Zm12,1.41a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29l.71-.71a1,1,0,0,0,0-1.41,1,1,0,0,0-1.41,0l-.71.71A1,1,0,0,0,17.66,8.46Zm0,10.6a1,1,0,0,0-.71-.71l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,17.66,19.06ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/></svg>
          
          <!-- moon icon -->
          <svg class="swap-off fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/></svg>
        </label>

        <div class="dropdown dropdown-end">
          <label tabindex="0" class="btn btn-ghost btn-circle avatar">
             <div class="w-9 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
               <img [src]="user()?.logoUrl || 'https://picsum.photos/seed/user/40/40'" alt="User Avatar" class="object-cover">
             </div>
          </label>
           <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow-lg bg-base-100 rounded-box w-52 border border-base-200">
             <li><a routerLink="/settings" class="py-2" (click)="closeGroup()">Settings</a></li>
             <div class="divider my-1"></div>
             <li><a (click)="logout(); closeGroup()" class="py-2 text-error">Logout</a></li>
           </ul>
        </div>
			</div>
		</header>
		
    <!-- Page content -->
		<main class="flex-grow bg-base-200">
      <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <router-outlet></router-outlet>
      </div>
    </main>
	</div>
  
  <!-- Mobile Drawer -->
	<aside class="drawer-side z-30">
		<label for="mobile-drawer" class="drawer-overlay"></label>
		<ul class="menu p-4 w-80 min-h-full bg-base-100 text-base-content">
      <li class="mb-6">
         <div class="flex flex-col items-start gap-4 p-4 bg-base-200/50 rounded-xl">
            <div class="avatar">
              <div class="w-14 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                <img [src]="user()?.logoUrl || 'https://picsum.photos/seed/user/40/40'" alt="User Avatar" class="object-cover">
              </div>
            </div>
            <div>
                <div class="font-bold text-lg">{{ user()?.name ?? 'User Name' }}</div>
                <div class="text-sm opacity-75">{{ user()?.email ?? 'user@example.com' }}</div>
            </div>
        </div>
      </li>
      <li class="menu-title text-primary uppercase tracking-wider font-bold mb-2">Navigation</li>
      
      @for(item of navGroups; track item.label || item.name){
        @if(item.type === 'link') {
           <li><a [routerLink]="item.path" routerLinkActive="active" (click)="toggleMobileMenu(); closeGroup()" class="py-3 text-base font-medium rounded-lg mb-1">{{ item.name }}</a></li>
        }
        @if(item.type === 'group') {
           <li>
             <details [open]="activeGroup() === item.label">
               <summary class="font-bold opacity-80" (click)="$event.preventDefault(); toggleGroup(item.label)">{{ item.label }}</summary>
               <ul>
                 @for(child of item.children; track child.path) {
                   <li><a [routerLink]="child.path" routerLinkActive="active" (click)="toggleMobileMenu(); closeGroup()" class="py-3 text-base font-medium rounded-lg mb-1">{{ child.name }}</a></li>
                 }
               </ul>
             </details>
           </li>
        }
      }

      <div class="divider"></div> 
      <li><a (click)="logout(); closeGroup()" class="text-error font-medium">Logout</a></li>
		</ul>
	</aside>
</div>
